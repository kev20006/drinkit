<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Drink-it</title>
    <!-- Import Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous"> 
    <!--Import Bootstrap-->
    <link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/css/main.css') }}">
</head>

<body>
    <nav id="nav" class="navbar navbar-light bg-light justify-content-between fixed-top">
        <div class="d-flex">
        <div class="d-flex nav-logo mr-2">
                <h5>
                    <a href="{{ url_for('index.index') }}">
                        <strong>
                            <i class="fas fa-glass-martini-alt"></i> 
                            <span class="d-none d-md-inline">Drinkit</span>
                        </strong>
                    </a>
                </h5>
        </div>
        <div class="d-flex py-0 ml-4">
            <select class="nav-search w-sm-25" type="text" id="type-filter">
                <option disabled selected> Quick Filters </option>
                <option>Spirits</option>
                <option>Mixers</option>
                <option>Garnish</option>
                <option>Other</option>
            </select>
            <span class="nav-button-3 mr-2" onclick="advancedFilter()"><i class="fas fa-filter"></i></span>
        </div>
    </div>
        <div class="d-flex">
                <span class="nav-button-3" onclick="toggleSearch()"><i class="fas fa-search"></i></span>
                <span class="nav-button-1 btn-active d-none d-md-block"><a href="{{ url_for('index.index', filter='recent') }}"><i class="fas fa-hourglass-start"></i></a></span>
                <span class="nav-button-2 d-none d-md-block"><a href="{{ url_for('index.index', filter='popular' ) }}"><i class="fas fa-chart-line"></i></a></span>
            {% if session['username'] %}
                <span class="nav-button-3 d-none d-md-block">
                    <a href="{{ url_for('view_user_profile', user_id=session['_id']) }}">{{ session['username'] }}</a>
                </span>
                <span class="nav-button-3 d-none d-md-block" ><a href="{{ url_for('login_logout.logout') }}">Log Out</a></span>
            {% else %}
                <span class="nav-button-4 d-none d-md-block" data-toggle="modal" data-target="#login">Login</span>
                <span class="nav-button-4 d-none d-md-block" data-toggle="modal" data-target="#sign-up">Sign-Up</span>
            {% endif %}
                <span class="nav-button-5 d-md-none navbar-toggler ml-2" data-toggle="collapse" data-target="#context-menu"><a><i class="fas fa-bars"></i></a></span>
        </div>
        <div id="context-menu" class="collapse navbar-collapse pt-3 d-md-none">
            <div class="d-flex flex-column">
                <strong>SORT:</strong>
                <span class="nav-button-2 d-md-none btn-active"><a href="{{ url_for('index.index', filter='recent') }}">
                    <i class="fas fa-hourglass-start"></i>Most Recent</a></span>
                <span class="nav-button-2 d-md-none"><a href="{{ url_for('index.index', filter='popular' ) }}"><i
                            class="fas fa-chart-line"></i>Most Popular</a></span>
                <hr>
                <strong>USERS:</strong>
                {% if session['username'] %}
                <span class="nav-button-2 d-md-none">
                    <a href="{{ url_for('view_user_profile', user_id=session['_id']) }}">{{ session['username'] }}</a>
                </span>
                <span class="nav-button-2 d-md-none"><a href="{{ url_for('login_logout.logout') }}">Log Out</a></span>
                {% else %}
                <span class="nav-button-2 d-block d-md-none" data-toggle="modal" data-target="login">Login</span>
                <span class="nav-button-2 d-block d-md-none" data-toggle="modal" data-target="#sign-up">Sign-Up</span>
                {% endif %}
            </div>
        </div>
    </nav>

    {% block content %}
    {% endblock %}
    <!-- Login Modal -->
    <div id="login" class="modal fade" aria-labelledby="login" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <h4>login</h4>
                
                <form action="{{ url_for('login_logout.login') }}" method="POST">
                    <div class="form-group">
                        <label for="username">Please Enter Your Username</label>
                        <input id="username" class="modal-input" name="username" type="text" aria-describedby="username"
                            placeholder="Enter Username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Please Enter Your Password</label>
                        <input id="password" name="password" class="modal-input" type="password" placeholder="Password">
                    </div>
                    <button class="modal-btn" type="submit">Sign in</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="sign-up" class="modal fade" aria-labelledby="sign up" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                <div class="row mx-0 px-2">
                    <div class="col-12">
                    <h4>Create Account</h4>
                    <p>By joining drinkit you are joining a brand new community of cocktail enthusiasts. As a member you will be able to
                        share
                        your creations, offer your advice to other like minded people and follow your favorite spirits, mixers or flavors to
                        get
                        new ideas to try in your bar or at home with your friends.</p>
                    
                    <p>To join all you need to do is provide a username and a 5 digit pin number that will serve as your password.</p>
                    </div>
                </div>
                <div class="row mx-0 px-2">
                    <form action="{{ url_for('login_logout.new_user') }}" method="POST" onsubmit="validatePasswords()">
                        <div class="form-group">
                            <label for="new-username">Please Enter Your Desired Username</label>
                            <input id="new-username" name="newusername" class="modal-input" type="text" placeholder="new username" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="new-password1">Please Enter Your Password</label>
                            <input id="new-password1" name="newpassword1" class="modal-input" type="password" placeholder="password" >
                        </div>
                        <div class="form-group">
                            <label for="new-password2">Please Re-Enter Your Password</label>
                            <input id="new-password2" name="newpassword2" class="modal-input" type="password" placeholder="password">
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <p id="password-error"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <button class="modal-btn" type="submit">Join Today</button>
                        </div>
                    </form>
                </div>
                <div class="row mx-0 px-2">
                <p><strong>Disclaimer:</strong> Drinkit is a practice project and has implemented minimal security so please don't
                    disclose any personal
                    information, I would also advise against using your email address as your username</p>
                </div>
            </div>
        </div>
    </div>

    <div id="search" class="d-none">
        <div class="container">
            <div class="d-flex justify-content-between">
                <h1 class="pink">Cocktail Search</h1>
                <h1 class="blue" onclick="toggleSearch()"><i class="fas fa-times"></i></h1>
            </div>
    
            <h3><input class="mt-2" placeholder="enter search term" oninput="search(this)"/></h3>
            <div id="results" class="row mx-0">
                <p id="no-results"></p>
                <ul id="cocktails-results" class="list-group col-12 col-md-3">
                </ul>
                <ul id="ingredients-results" class="list-group col-12 col-md-3">
                </ul>
                <ul id="flavors-results" class="list-group col-12 col-md-3">
                </ul>
                <ul id="users-results" class="list-group col-12 col-md-3">
                </ul>
                
            </div>
        </div>
    
    </div>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <script src="/static/scripts/utilities.js" charset="utf-8"></script>   
    <script src="/static/scripts/favorites.js" charset="utf-8"></script>
    <script src="/static/scripts/votes.js" charset="utf-8"></script>
    <script src="/static/scripts/validatePasswords.js" charset="utf-8"></script>
    {% block scripts %}
    {% endblock %}
    <script>
        const toggleSearch = () =>{
            document.querySelector("#search").classList.toggle("d-none");
        }

        const search = (trigger) => {
            typeList = ["cocktails", "users", "flavors", "ingredients"];
            if (trigger.value == ""){
                typeList.forEach(type => {
                    document.querySelector(`#${type}-results`).innerHTML = "";
                });
            }else{
                typeList.forEach(type =>{
                    fetch(`/s/${type}/${trigger.value}`)
                        .then(response => response.json())
                        .then(data => {
                            document.querySelector(`#${type}-results`).innerHTML = "";
                            if (!data.length < 1) {
                                let title = document.createElement("li")
                                title.innerHTML = `<strong>${type}</strong>`
                                title.className = "list-group-item pink mb-2 result-title"
                                document.querySelector(`#${type}-results`).appendChild(title)
                                data.forEach(element => {
                                    let newItem = createItem(type,element)
                                    document.querySelector(`#${type}-results`).appendChild(newItem)
                                })
                            }
                        })
                        .catch(error => console.error(error));
                })
                //catch no results returned
                if( !document.querySelector(`#cocktails-results`).hasChildNodes  &&
                    document.querySelector(`#users-results`).hasChildNodes &&
                    document.querySelector(`#flavors-results`).hasChildNodes &&
                    document.querySelector(`#ingredients-results`).hasChildNodes)
                    {
                        document.querySelector("#no-results").textContent = "No Results Found"
                    }
                    else{
                        document.querySelector("#no-results").textContent = ""
                    }

            }
            
        }

        const createItem = (type, item) => {
            let newItem = document.createElement("li")
            newItem.className = "list-group-item";
            switch (type){
                case "cocktails":
                    newItem.innerHTML = `<a href="/v/cocktail/${item._id.$oid}">${item.name}</a>`
                break;
                case "users":
                    newItem.innerHTML = `<a href="/v/user_profile/${item._id.$oid}">${item.username}</a>`
                break;
                case "ingredients":
                    newItem.innerHTML = `<a href="/v/ingredient/${item.name}">${item.name}</a>`
                break;
                case "flavors":
                    newItem.innerHTML = `<a href="/v/flavor/${item.name}">${item.name}</a>`
                break;
            }
            return newItem;
        }
    </script>
</body>
</html>